<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buscador de Impresoras</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f4f6fa; margin: 0; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; color: #0b63c8; }
    .searchbar { display: flex; gap: 10px; margin-bottom: 20px; }
    .searchbar input { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
    .btn-clear { background-color: #ff6a00; color: #fff; }
    .btn-google { background-color: #d93025; color: #fff; margin-top: 15px; display: block; width: 100%; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card { background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .card header { background-color: #0f5ab0; color: #fff; padding: 10px; border-radius: 8px 8px 0 0; font-weight: bold; }
    .card .body { padding: 10px; min-height: 150px; }
    ul { margin: 0; padding-left: 20px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>BUSCADOR DE IMPRESORAS</h1>
    <div class="searchbar">
      <input id="q" type="text" placeholder="Escribe modelo (p. ej. TS3350, TR 4751…)" autocomplete="off">
      <button id="clear" class="btn btn-clear">Limpiar</button>
    </div>
    <div class="grid">
      <section class="card">
        <header>CONSUMIBLES</header>
        <div id="consumibles" class="body">—</div>
      </section>
      <section class="card">
        <header>CAPACIDAD</header>
        <div id="capacidad" class="body">—</div>
      </section>
    </div>
    <button id="google" class="btn btn-google">Buscar en Google</button>
  </div>

<script>
(() => {
  const $ = sel => document.querySelector(sel);
  const input = $('#q');
  const outCons = $('#consumibles');
  const outCap = $('#capacidad');
  const btnClear = $('#clear');
  const btnGoogle = $('#google');

  const DATASET_URL = 'https://raw.githubusercontent.com/guiradimar/MODELO-IMPRESORA.MC/main/dataset_impresoras_v2.json';

  let DATA = [];

  const normalize = s => (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();
  const firstOf = (obj, keys) => {
    for (const k of keys) {
      if (obj && obj[k]) return String(obj[k]);
    }
    return '';
  };

  async function loadData() {
    try {
      const res = await fetch(DATASET_URL);
      const json = await res.json();
      if (Array.isArray(json)) DATA = json;
    } catch (e) {
      console.error('Error cargando dataset', e);
    }
  }

  function search() {
    const q = normalize(input.value);
    if (!q) { outCons.textContent = '—'; outCap.textContent = '—'; return; }
    const hits = DATA.filter(row => {
      return normalize(firstOf(row, ['compatibilidades','descripcion','referencia','consumible'])).includes(q);
    });
    const cons = new Set(), caps = new Set();
    for (const h of hits) {
      firstOf(h, ['consumible']).split(/[,;]/).forEach(v => v && cons.add(v.trim()));
      firstOf(h, ['capacidad']).split(/[,;]/).forEach(v => v && caps.add(v.trim()));
    }
    outCons.innerHTML = cons.size ? '<ul>' + [...cons].map(v=>'<li>'+v+'</li>').join('') + '</ul>' : '—';
    outCap.innerHTML = caps.size ? '<ul>' + [...caps].map(v=>'<li>'+v+'</li>').join('') + '</ul>' : '—';
  }

  btnClear.addEventListener('click', () => { input.value=''; outCons.textContent='—'; outCap.textContent='—'; input.focus(); });
  input.addEventListener('keydown', e => { if (e.key === 'Enter') search(); });
  btnGoogle.addEventListener('click', () => {
    if (input.value) window.open('https://www.google.com/search?q='+encodeURIComponent(input.value), '_blank');
  });

  loadData();
})();
</script>
</body>
</html>
