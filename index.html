<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buscador de Impresoras</title>
  <style>
    :root{
      --primary:#0f4c81;
      --accent:#ff6a00;
      --bg:#f5f7fb;
      --panel:#ffffff;
      --text:#1b2b3a;
      --muted:#7a8aa0;
      --ok:#10893e;
      --danger:#cc2936;
      --shadow: 0 10px 25px rgba(16,33,54,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
      display:flex; flex-direction:column;
    }
    header{
      padding:28px 16px 12px;
      text-align:center;
    }
    h1{
      margin:0;
      letter-spacing:.02em;
      color:var(--primary);
      font-weight:800;
      font-size: clamp(28px, 4vw, 42px);
      text-transform:uppercase;
    }
    .search-wrap{
      display:flex; gap:10px; justify-content:center; align-items:center;
      margin:18px auto 8px; padding:0 16px; width: min(980px, 94%);
    }
    .search{
      flex:1; display:flex; align-items:center; background:#fff; border-radius:12px;
      box-shadow: var(--shadow);
      padding:6px 10px;
      border:1px solid #e7eaf0;
    }
    .search input{
      width:100%; border:none; outline:none; font-size:16px; padding:12px 10px;
      background:transparent;
    }
    .btn{
      border:none; outline:none; cursor:pointer;
      padding:12px 16px; border-radius:10px; font-weight:600; font-size:15px;
      transition:transform .06s ease, filter .06s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn-clean{ background: var(--accent); color:#fff; }
    .btn-google{ background:#e53935; color:#fff; display:block; margin:18px auto 6px; }
    .btn-google:hover{ filter:brightness(1.05) }
    .grid{
      width:min(1100px, 96%); margin:14px auto 0; display:grid; gap:20px;
      grid-template-columns: 1fr; 
    }
    @media (min-width: 880px){
      .grid{ grid-template-columns: 1fr 1fr; }
    }
    .card{
      background:var(--panel); border-radius:16px; box-shadow: var(--shadow);
      border:1px solid #e8edf5; overflow:hidden;
    }
    .card header{
      text-align:left; padding:14px 18px; background: linear-gradient(180deg, #f8fbff, #fff);
      border-bottom:1px solid #eef2f8;
    }
    .card h2{
      margin:0; font-size:18px; letter-spacing:.02em; color:#0b5fb6;
      text-transform:uppercase;
    }
    .card .content{
      padding:16px 18px; min-height:230px;
    }
    .muted{ color:var(--muted); font-style:italic; }
    .pill{
      display:inline-block; background:#eef5ff; color:#0b5fb6; padding:6px 10px; border-radius:999px;
      font-weight:600; font-size:12px; letter-spacing:.02em; margin-right:8px;
    }
    .error{
      text-align:center; color:var(--danger); font-weight:700; margin-top:6px;
      min-height:22px;
    }
    ul{ margin:0; padding-left:18px; }
    li{ margin:6px 0; }
    footer{
      margin-top:auto; padding:14px; text-align:center; color:var(--muted); font-size:13px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Buscador de Impresoras</h1>
    <div class="search-wrap">
      <div class="search" role="search">
        <input id="q" type="text" placeholder="Escribe modelo o cartucho… (p.ej. TS3350, TR4751, 4751…)" autocomplete="off" />
      </div>
      <button id="clearBtn" class="btn btn-clean" title="Limpiar">Limpiar</button>
    </div>
    <div id="errorBox" class="error" aria-live="polite"></div>
  </header>

  <main class="grid" aria-live="polite">
    <section class="card" aria-labelledby="h-cons">
      <header><h2 id="h-cons">Consumibles</h2></header>
      <div class="content" id="consBox"><p class="muted">Sin resultados.</p></div>
    </section>

    <section class="card" aria-labelledby="h-cap">
      <header><h2 id="h-cap">Capacidad</h2></header>
      <div class="content" id="capBox"><p class="muted">Sin resultados.</p></div>
    </section>
  </main>

  <button id="googleBtn" class="btn btn-google">Buscar en Google</button>

  <footer>© <span id="year"></span> — Buscador de consumibles y capacidades</footer>

  <script>
    // === Ajusta SOLO este nombre si cambias el JSON ===
    const DATA_URL = 'data_impresoras_v2.json';
    // ================================================

    let DATA = [];
    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>document.querySelectorAll(sel);
    const qInput = $('#q');
    const errorBox = $('#errorBox');
    const consBox = $('#consBox');
    const capBox = $('#capBox');
    const clearBtn = $('#clearBtn');
    const googleBtn = $('#googleBtn');
    $('#year').textContent = new Date().getFullYear();

    // Normaliza texto: minúsculas, sin espacios ni guiones
    const normalize = (s='') => s.toString().toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
      .replace(/[\s\-_.,/]+/g,'')
      .trim();

    async function loadData(){
      try{
        const res = await fetch(DATA_URL, { cache: 'no-store' });
        if(!res.ok) throw new Error('HTTP '+res.status);
        DATA = await res.json();
        errorBox.textContent = '';
      }catch(err){
        errorBox.textContent = 'Error cargando el dataset. Revisa el nombre y ubicación del JSON.';
        console.error('Carga JSON:', err);
      }
    }

    function renderList(container, items){
      if(!items || items.length === 0){
        container.innerHTML = '<p class="muted">Sin resultados.</p>';
        return;
      }
      // Si hay pocos elementos, lista; si son cadenas largas, párrafos
      const many = items.length > 12;
      if (many){
        container.innerHTML = '<ul>'+items.slice(0,200).map(x=>'<li>'+escapeHtml(x)+'</li>').join('')+'</ul>';
      }else{
        container.innerHTML = '<ul>'+items.map(x=>'<li>'+escapeHtml(x)+'</li>').join('')+'</ul>';
      }
    }

    function escapeHtml(str){
      return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;');
    }

    function search(){
      const raw = qInput.value;
      const q = normalize(raw);
      if(!q){
        consBox.innerHTML = '<p class="muted">Sin resultados.</p>';
        capBox.innerHTML = '<p class="muted">Sin resultados.</p>';
        return;
      }

      const setCons = new Set();
      const setCap = new Set();

      for(const row of DATA){
        const comp = normalize(row.compatibilidades || '');
        const desc = normalize(row.descripcion || '');
        if (comp.includes(q) || desc.includes(q)){
          if (row.consumibles) setCons.add(row.consumibles);
          if (row.capacidad) setCap.add(row.capacidad);
        }
      }

      renderList(consBox, Array.from(setCons));
      renderList(capBox, Array.from(setCap));
    }

    // Eventos
    qInput.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){ e.preventDefault(); search(); }
    });
    qInput.addEventListener('input', debounce(search, 250));
    clearBtn.addEventListener('click', ()=>{
      qInput.value = '';
      qInput.focus();
      consBox.innerHTML = '<p class="muted">Sin resultados.</p>';
      capBox.innerHTML = '<p class="muted">Sin resultados.</p>';
    });
    googleBtn.addEventListener('click', ()=>{
      const q = qInput.value.trim();
      if(!q) return;
      window.open('https://www.google.com/search?q='+encodeURIComponent(q), '_blank');
    });

    function debounce(fn, wait){
      let t; 
      return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(null,args), wait); };
    }

    // Inicia
    loadData();
  </script>
</body>
</html>
